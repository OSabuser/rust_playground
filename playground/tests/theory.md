# Написание тестов  

## Юнит тесты  

- Тестирование изолированных участков кода. Например, реализации приватных модулей  
- Все юнит-тесты принято инкапсулировать в рамках одного модуля
- Модуль тестирования обычно определяется прямо рядом с кодом  
- В тестах можно использовать сущности из родительского модуля `use super::*`  

```rust
pub struct Trie {}
impl Trie {}


#[cfg(Test)] // Компиляция только в тестах
mod tests { // Отдельный модуль
    use super::*; // Импортируем всё из тестируемого
    #[test] // Тестовая функция
    fn test_new() {
        let trie = Trie::new();
    }
    // Тест пройден, если нет паники!!
    // Обычно тестовые функции ничего не принимают и не возвращают
}
```

### Пример тестовой функции  

```rust
#[test]
#[should_panic(expected = "attempt to divide by zero")]
// should panic указывается, если в тесте должна возникнуть паника
fn test() {
    let (x, y) = setup();
    assert_eq!(y, 0);// Или assert!(y != 0)
    assert_ne!(x, 0);// Или assert!(x != 0)
    x/y;
}

```  

## Интеграционные тесты  

- Используют тестируемую библиотеку в качестве зависимости
- Тестирование кода как единое целое
- Хранятся вместе с иходным кодом в папке tests в отдельном файле
- Нет возможности тестировать приватный код

```rust
//tests/integration.rs  
use my_library::*;

#[test]
fn integration_test1() {
    //...
}
#[test]
fn integration_test2() {
    //...
}


```

## Док-тесты  

> В рамках док тестирования будет выполняться код, заключенный между **```**.
Символом # обозначается код, который не будет отображаться в конечной документации, но при этом будет выполняться в процессе тестов  

```rust
///
/// 1. Умный дом
///     В текущей версии может содержать до 5 комнат с 10 умными устройствами в каждой
///
/// ## Параметры
///
/// * `name` - пользовательский псевдоним для дома
/// * `smart_rooms` - список комнат (хэш таблица, где key - уникальное имя комнаты, value - конкретный экземпляр комнаты с именем key)
/// * `room_limit` - максимальное допустимое число комнат в доме
/// * `device_limit` - максимальное допустимое число умных устройств в комнате
/// 
/// ## Использование:
/// ```
/// let mut my_house = SmartHouse::new("MyS_1");
/// my_house.add_room("MainRoom")"
/// # assert!(!my_house.smart_rooms.is_empty());
/// ``` 
///
struct SmartHouse<'a> {
    name: String,
    smart_rooms: HashMap<String, Vec<Box<&'a dyn SmartDevice<ErrorType = dyn Display>>>>,
    room_limit: usize,
    device_limit: usize,
}
```

### Аттрибуты тестов

```rust
///```no_run
/// loop {
/// println!("Hey!);
/// }
/// ```

///```compile_fail
/// let x=5;
/// x += 2; // shouldn't compile!
/// ```
```

## Бенчмарки  

- Как тесты, но отмечены аттрибутом #[bench] (nigthly-only)
- Располагаются в директории `benches/`
- Лучше использовать сторонние библиотеки, например `criterion.rs от bheisler`

## Запуск тестов  

```bash
cargo test [<substring_of_test_name>]
# С выводом stdout
cargo test -- --show-output
# Запуск теста в один поток
cargo test -- --test-threads=1
```
